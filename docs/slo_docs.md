# SLO Document

<!-- ステークホルダーや有効期間などを書いておく -->
| Status                  | Published         |
| ----------------------- | ----------------- |
| Author                  | Alice         |
| SRE Approvers           | Charlie           |
| Developer Approvers     | Bob       |
| Product Manager Approvers | Dave         |
| Publish Date            | 2022-07-01        |
| Revisit Date            | 2022-10-31        |

## サービスの概要

<!-- サービスの概要を書く -->
- ブログのエントリを投稿、表示するBlogサービスと、ユーザーログインを処理するAccountサービスの2つのマイクロサービスで成り立っている

### 構成図

<!-- サービスの構成図を載せておくと良い -->

### 関連するコンポーネントやマイクロサービス

<!-- 利用しているマイクロサービス、SaaSなど書いておく -->
- Blog サービス
- Account サービス

## SLI/SLO

<!-- ウィンドウサイズ（計測単位）を書いておく -->
- ローリングウィンドウ
  - 30日

### Blog サービス

| Category     | SLI                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | SLO                                     |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------- |
| Availability | ALB のメトリックから測定された、成功したリクエストの割合。500〜599 以外の HTTP ステータスは成功 (1-(500 系/総数)) | 99.9%                                   |
| Latency      | ALB のメトリックから測定された、`投稿API`(\*1)以外のリクエストの割合。「十分に速い」= 300 ミリ秒未満 〜 500 ミリ秒未満 | 90％tile<300 ミリ秒, 99%tile<500 ミリ秒 |
| Latency  | ALB のメトリックから測定された、十分に高速な `投稿API` (\*1) のリクエストの割合。「十分に速い」= 500 ミリ秒未満 〜 1000 ミリ秒未満 | 90％tile<500 ミリ秒, 99%tile<1000 ミリ秒 |

\*1 request_url が `https://localhost/api/post` のリクエスト

#### 参考指標

<!-- SLOの候補になりそうだったり、まだ実装されていないSLOとかを記載しておくのも良い -->

SLO としては運用しないが SLO 違反したときに参考となる値です。スプリントレビューなどで確認する時に目標とする値を記載します。

| Category | SLI                                                                                                                                                                                                                                                                                                                     | 参考目標値                  |
| :------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------- |
| Latency  | ALB のメトリックから測定された、十分に高速なAccountサービスのリクエストの割合。「十分に速い」= xxx ミリ秒未満 〜 yyy ミリ秒未満 | TODO しばらく計測してSLOを決定する |

## 根拠

- これらの数値がユーザーエクスペリエンスと強く相関していることを確認する試みはまだ行われていない
  - サービス要件や本来欲しい値ではなく、現在の値や現状で計測可能な SLI を元に作成している
    - 2022/5〜2022/6の実績値をもとにSLO値を設定している

## エラーバジェット

- エラーバジェットは 100% - SLO である
- ローリングウィンドウは 2 週間
  - 2 週間のトータルで SLO を満たしていない場合はエラーバジェットを実施することになる
  - これらは PWG で確認する

各 SLO のうち、1 つでもエラーバジェットを使い切った場合は、エラーバジェットポリシーを実施する

## 補足

- スプリントレビュー時にProduct Manager、SRE、Developerで達成状況やエラーバジェットの推移を確認する